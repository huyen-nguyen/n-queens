<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
	<meta name="generator" content="Jekyll v4.1.1">
	<link rel="shortcut icon" href="images/Gaming-Queen.ico"/>
	<script src="lib/d3.v4.min.js"></script>

	<title>N-queens SAT</title>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>

	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css"
		  integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

	<style>
		.bd-placeholder-img {
			font-size: 1.125rem;
			text-anchor: middle;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}

		@media (min-width: 768px) {
			.bd-placeholder-img-lg {
				font-size: 3.5rem;
			}
		}
	</style>
	<!-- Custom styles for this template -->
	<link href="grid.css" rel="stylesheet">
</head>
<body class="py-4">
<script src="js/solver.js"></script>

<div class="container">

	<h1>N-queens Problem SAT Solver</h1>
	<p class="lead">Simple SAT solver for the <a href="https://developers.google.com/optimization/cp/queens"
												 target="_blank"
	>n-queens problem</a>. Just in put the number of queens.</p>

	<!--	<p class="mb-5">&nbsp;</p>-->

	<div class="row mb-3">
		<div class="col-md-8">
			<div>
				<div class="form-group mb-2" style="display: inline-block">
					<label>Number of Queens</label>
				</div>
				<div id="selectPanelDiv" class="form-group mx-sm-3 mb-2" style="display: inline-block">
				</div>
				<button id="runbutton" class="btn btn-success mb-2">Run</button>
				<div id="result" class="btn">Loading</div>
			</div>
		</div>

	</div>
	<div class="row mb-3 wrapper container">
		<div id="cnf-wrapper" class="col-md-4 themed-grid-col bg-light">
			<div>
				<h4><code>CNF Formula in DIMACS</code></h4>
			</div>
			<div id="editor-wrapper" style="overflow: scroll !important;">
				<div id="editor"></div>
			</div>
		</div>
		<div class="col-md-8 themed-grid-col bg-light">
			<div>
				<h4><code>Output</code></h4>
			</div>
			<div id="output-wrapper" style="height:400px; overflow: auto">
				<div class="row">
					<div id="output" class="col-md-12 bg-light" readOnly="true" spellcheck="false">
					</div>
					<div id="chessboard" class="col-md-12 bg-light">
						Another child
					</div>
				</div>
			</div>
		</div>

	</div>


</div>

</div>
<script src="js/interface.js"></script>


<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>

<!-- FontAwesome -->
<script src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

<!-- Default Statcounter code for cyrptominisat_web
http://msoos.github.io/cryptominisat_web/ -->
<script type="text/javascript">
	var sc_project = 11721099;
	var sc_invisible = 1;
	var sc_security = "7e859659";
</script>
<script type="text/javascript"
		src="https://www.statcounter.com/counter/counter.js"
		async></script>
<noscript>
	<div class="statcounter"><a title="Web Analytics"
								href="http://statcounter.com/" target="_blank"><img
		class="statcounter"
		src="//c.statcounter.com/11721099/0/7e859659/1/" alt="Web
Analytics"></a></div>
</noscript>
<!-- End of Statcounter Code -->

<script>
	function base64dec(x) {
		try {
			if (x.length % 4 != 0) {
				x = x.padEnd(x.length + (4 - (x.length % 4)), '=')
			}
			return atob(x.replace(/-/g, '+').replace(/_/g, '/'))
		} catch (err) {
			return ''
		}
	}

	function base64enc(x) {
		return btoa(x).replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '')
	}

	function copyToClipboard(x) {
		// Create an invisible text area
		var target = $('<textarea>')
			.css('position', 'absolute')
			.css('left', '-9999px')
			.css('top', '0px')
			.val(x)
		$('body').append(target);

		// Copy the contents
		target.focus()
		target[0].setSelectionRange(0, x.length)
		document.execCommand('copy')

		// Remove it from the page
		target.remove()
	}

	// $().ready(function () {
	//
	// 	// Load text from the URL hash if it's there
	// 	if (window.location.hash) {
	// 		var hash = window.location.hash.substring(1);
	// 		$('#editor').val(base64dec(hash));
	// 		$('#save').removeAttr('disabled');
	// 	} else {
	// 		$.ajax({
	// 			url: "minisat/test.cnf",
	// 			dataType: "text",
	// 			success: function (data) {
	// 				$('#editor').val(SAT_expression(5));
	// 				$('#save').removeAttr('disabled');
	// 			}
	// 		});
	// 	}
	//
	// 	// Clear the hash whenever the code is updated
	// 	$("#result").on('click', function () {
	// 		window.location.hash = '';
	// 	})
	//
	// 	// Save button implementation
	// 	$('#save').click(function () {
	// 		// Push a new history item and change the URL
	// 		window.location.hash = '';
	// 		history.pushState(
	// 			{'source': editor.getValue()},
	// 			'', // title
	// 			window.location.href.replace(/#$/, '') + '#' + base64enc(editor.getValue())
	// 		)
	//
	// 		// Copy the URL to the clipboard
	// 		copyToClipboard(window.location.href);
	//
	// 		// Show and hide the popover as a visual indication
	// 		var x = this;
	// 		$(this).popover('show');
	// 		setTimeout(function () {
	// 			$(x).popover('hide');
	// 		}, 700);
	// 	})
	// })
</script>

<script src="minisat/cryptominisat5_simple.js" type="text/javascript" charset="utf-8"></script>
<script>

	function scroll() {
		document.getElementById("output").scrollTop = document.getElementById("output").scrollHeight;
	}

	function at_bottom() {
		var height = document.getElementById("output").offsetHeight;
		return (document.getElementById("output").scrollTop + height) >= document.getElementById("output").scrollHeight;
	}

	Module['onRuntimeInitialized'] = function () {
		$().ready(function () {
			$('#runbutton').removeAttr("disabled")
			$('#result').text('Ready');
		})
	}
	Module['print'] = function (text) {
		var bottom = at_bottom();
		console.log(text)
		$('#output').append("<code>" + text + "</code><br/>")
		// outputString = outputString + (text + "\n")
		if (bottom) {
			scroll();
		}
	};
	Module['printErr'] = function (text) {
		$('#output').append("<code>--error-- " + text + "</code><br/>")
		// outputString = outputString + ("--error-- " + text + "\n")
		scroll();
	};


	must_stop = false;
	running = false;

	function check_result(result) {

		if (must_stop) {
			$('#output').append("<code>Stopped.<code><br/>")
			$('#result').text('Ready');
			$('#playbut').removeClass("fa-stop");
			$('#playbut').addClass("fa-play");

			scroll();
			must_stop = false;
			running = false;
			return;
		}

		var nconfl = num_conflicts();
		$('#result').text(nconfl + " confl");
		if (result == 0) {
			$('#result').text('SATISFIABLE');
			running = false;
		} else if (result == 1) {
			$('#result').text('UNSATISFIABLE');
			running = false;
		} else if (result == 2) {
			window.setTimeout(function () {
				var result = cont_query();
				check_result(result);
			}, 50);
		}

		if (!running) {
			$('#playbut').removeClass("fa-stop");
			$('#playbut').addClass("fa-play");
		}
	}

	$().ready(function () {
		$('#runbutton').click(function () {
			if (running) {
				must_stop = true;
				$('#output').append("<code>Stopping...</code><br/>")
				// outputString = outputString + ("Stopping...\n")
				scroll();
				return;
			}
			let val = parseInt(document.getElementById("inputNumber").value)
			if (!isValid(val)){
				$("#editor").html("<code style='color: #a00000'>invalid input!</code>")
				$('#output').html("")
				return
			}
			$("#editor").html(formatCNF(SAT_expression(val)))
				running = true;
			$('#playbut').removeClass("fa-play");
			$('#playbut').addClass("fa-stop");

			$('#result').text('Running');

			var source = SAT_expression(val);
			colorNormal(val)
			try {
				var result = cms_query(source)
				check_result(result);
			} catch (err) {
				console.log(result);
				console.log(err);
				running = false;
				must_stop = false;
				$('#result').text('Error');
			}
		})
	})

</script>

<script>
	function cms_query(source) {
		$('#output').html("");
		scroll();
		var solve_function = Module.cwrap('cstart_solve', 'number', ['string']);
		ret = solve_function(source);
		return ret;
	}

	function cont_query() {
		var cont_function = Module.cwrap('ccontinue_solve', 'number');
		ret = cont_function();
		return ret;
	}

	function num_conflicts() {
		var num_conflicts_function = Module.cwrap('cget_num_conflicts', 'number');
		ret = num_conflicts_function();
		return ret;
	}
</script>


</body>
</html>
